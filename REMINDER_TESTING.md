# 提醒功能测试计划

## 测试环境准备

### 1. 数据库迁移
```bash
# 运行数据库迁移脚本
mysql -u root -p plant_health_db < backend/migration_add_reminder_reason.sql
```

### 2. 启动后端服务
```bash
cd backend
python main.py
# 或者
uvicorn main:app --reload
```

### 3. 启动前端服务
```bash
cd front
npm install  # 如果还未安装依赖
npm run dev
```

## 功能测试清单

### 测试1: AI诊断自动创建提醒

#### 步骤：
1. 登录用户账号
2. 上传植物照片进行诊断
3. 等待AI分析结果
4. 检查诊断结果中是否包含提醒建议字段：
   - `reminder_type`: 浇水提醒/复查提醒/无
   - `reminder_reason`: 提醒原因说明
   - `reminder_days`: 建议提醒天数

#### 预期结果：
- 诊断结果包含新的提醒字段
- 如果 reminder_type 不是"无"，后台自动创建提醒记录
- 提醒计划时间 = 当前时间 + reminder_days 天

### 测试2: 提醒原因显示

#### 步骤：
1. 登录用户账号
2. 进入"我的"页面
3. 点击"提醒消息"
4. 查看提醒列表

#### 预期结果：
- 每个提醒显示提醒类型图标（浇水=水滴图标，复查=相机图标）
- 显示提醒标题
- 显示提醒原因（蓝色背景框）
- 显示提醒消息
- 显示计划时间

### 测试3: 3天提醒规则

#### 步骤：
1. 创建一个计划时间为今天的提醒
2. 创建一个计划时间为3天后的提醒
3. 创建一个计划时间为4天后的提醒
4. 刷新"我的"页面
5. 查看提醒消息图标上的未读数量徽章

#### 预期结果：
- 未读数量应该包含：
  - 计划时间 <= 今天的提醒
  - 计划时间 <= 今天+3天的提醒
- 不应该包含：
  - 计划时间 > 今天+3天的提醒（如4天后的）

### 测试4: 不同诊断状态的提醒类型

#### 测试用例：
1. **缺水植物** → 应该生成"浇水提醒"
2. **病害植物** → 应该生成"复查提醒"
3. **虫害植物** → 应该生成"复查提醒"
4. **光照不当** → 应该生成"复查提醒"
5. **缺肥植物** → 应该生成"复查提醒"
6. **健康植物** → 可能生成"浇水提醒"或"无"

#### 预期结果：
- 每种诊断状态都按照规则生成对应的提醒类型
- 提醒原因说明应该与诊断问题相关

### 测试5: 手动创建提醒（我的植物）

#### 步骤：
1. 创建或编辑一个植物
2. 设置浇水频率（如5天）
3. 设置上次浇水日期
4. 保存植物

#### 预期结果：
- 自动创建浇水提醒
- 提醒计划时间 = 上次浇水日期 + 浇水频率
- 提醒原因包含浇水周期说明

### 测试6: 复查提醒创建

#### 步骤：
1. 进入植物详情页面
2. 点击"创建复查提醒"按钮
3. 查看提醒消息列表

#### 预期结果：
- 创建7天后的复查提醒
- 提醒原因包含复查必要性说明

### 测试7: 提醒标记为已读

#### 步骤：
1. 打开提醒消息页面
2. 点击提醒右侧的"✓"按钮
3. 检查提醒状态和未读数量

#### 预期结果：
- 提醒被标记为已完成和已读
- 未读数量减少
- 提醒从未完成列表中移除

### 测试8: Prompt.md 更新验证

#### 步骤：
1. 查看 backend/prompt.md 文件
2. 检查是否包含新的字段说明和示例

#### 预期结果：
- 包含 reminder_type、reminder_reason、reminder_days 字段定义
- 所有三个示例都包含新字段
- 字段说明清晰准确

## 数据验证

### 检查数据库中的提醒记录：
```sql
-- 查看最新创建的提醒
SELECT 
    id, 
    user_id, 
    reminder_type, 
    title, 
    reminder_reason,
    scheduled_date,
    is_read,
    is_completed,
    created_at
FROM reminders
ORDER BY created_at DESC
LIMIT 10;

-- 查看3天内的提醒数量
SELECT COUNT(*) as count_within_3_days
FROM reminders
WHERE scheduled_date <= DATE_ADD(NOW(), INTERVAL 3 DAY)
  AND is_completed = 0
  AND is_read = 0;
```

## 问题排查

### 如果提醒未自动创建：
1. 检查 AI 返回的 JSON 是否包含 reminder_type、reminder_reason、reminder_days
2. 检查 reminder_type 是否为"无"
3. 检查 reminder_days 是否 > 0
4. 检查后端日志是否有错误

### 如果未读数量不正确：
1. 检查提醒的 scheduled_date
2. 验证 3 天规则的计算逻辑
3. 检查 is_read 和 is_completed 状态

### 如果提醒原因未显示：
1. 检查数据库中 reminder_reason 字段是否有值
2. 检查前端是否正确渲染 reminder_reason
3. 验证 API 响应是否包含该字段

## 成功标准

所有以下条件都应该满足：
- ✅ AI 诊断后自动创建包含原因的提醒
- ✅ 提醒原因在前端正确显示
- ✅ 3天提醒规则正确实施
- ✅ 未读提醒徽章正确显示数量
- ✅ 不同诊断状态生成正确的提醒类型
- ✅ 手动创建的提醒包含原因说明
- ✅ 数据库迁移成功完成
